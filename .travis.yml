language: objective-c
osx_image: xcode7.3
xcode_workspace: browteco.xcworkspace
xcode_scheme: browteco
xcode_sdk: iphonesimulator9.3
script:
- xctool -workspace browteco.xcworkspace -scheme browteco -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO
- xctool test -workspace browteco.xcworkspace -scheme browtecoTests -sdk iphonesimulator ONLY_ACTIVE_ARCH=NO
env:
  global:
  - APP_NAME="browteco"
  - 'DEVELOPER_NAME="iPhone Distribution: Joao Paulo Alves (F4V48FFS39)"'
  - PROFILE_NAME="iOS_Team_Provisioning_Profile_"
  - secure: 0ae3vbu5NWi4J+WCFQ/z2yMlWJu7aa0rh/BZquNZ1br75FW+R3mFn/RJf3VZH5ruBaaMniXWadUQ9xPpikn9epIDpB+qGR7xzJxot2VZ4p7QZ9ll5NJOeAO5cJV5RZsE73SCeYOE5KPmadKj/LVII+6h2PzJvOdzNmAuxtlSJXYEJ0wswLo3/oAQ9GsvvdENtKjytnF39NIN5CCbbp2D5zGWAXllBbBKCgkiCN4Cn7YtajlgRfpmvMie/EYVFyMz21+6v4rPyJZhKlxXllm/uFQ7z4ojtFJ1/FyKOKSyPy2+Fx2tYf22XY/SH/tIbXouqD3R/UvuaQq//V3sx9DyHGLN5+TdPA+gjNPPCiWOIjO/vYsK/O0K5STUvNvQGfrvG0V9DkG9fuMU5mxBaZwQDg93TK23LC1b0DAv/kHGILY8hZY1wVj33TeVMag/kicrwqxfEFveHWlBcHPmGQ8+aw1lvKeopRrFbEbtCiUBCsG31RivyxjrAxxHcg1VIhWXh+z/iPnZ+okG8L8Ck9LVXdRjg7thrOpttnqN1qDCMSeXRs9HPzlLR0m5TO6k4xL2Yv82AB0/x3fPDrykBxwGNnLitvwOp2lFabsrbKfzOiyxEK7ZZ+fa7dBMB76CXG7RcQQA0YKY+WhxuD4X56Z6rUyatZBdfgw8hjTJwG8GyhQ=
before_script:
- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/profile/iOS_Team_Provisioning_Profile_.mobileprovision.enc
  -d -a -out scripts/profile/iOS_Team_Provisioning_Profile_.mobileprovision
- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/profile/distbrowteco.mobileprovision.enc
  -d -a -out scripts/profile/distbrowteco.mobileprovision

- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.cer.enc -d -a
  -out scripts/certs/dist.cer
- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dist.p12.enc -d -a
  -out scripts/certs/dist.p12

- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/ios_development.cer.enc
  -d -a -out scripts/certs/ios_development.cer
- openssl aes-256-cbc -k "$ENCRYPTION_SECRET" -in scripts/certs/dev.p12.enc -d -a
  -out scripts/certs/dev.p12

- chmod a+x ./scripts/add-key.sh
- ./scripts/add-key.sh
after_success:
- ./scripts/sign-and-upload.sh
after_script:
- ./scripts/remove-key.sh
